@model BokToppen.Models.ViewModels.BookReviewsViewModel

@{
     if (TempData.ContainsKey("unsuccessful")){
        <div class="alert alert-warning mt-2" role="alert">
        @TempData["unsuccessful"]
        </div>
    }

}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a asp-action="Index">Böcker</a></li>
    <li class="breadcrumb-item active" aria-current="page">@Model.Book.Title</li>
  </ol>
</nav>

@* Bok informationen *@
<div class="card mb-3 border-dark">
  <img src="https://images.pexels.com/photos/824197/pexels-photo-824197.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" class="card-img-top" alt="..." style="height: 30vh; object-fit: cover;">
  <div class="card-body">
    <h5 class="card-title">@Model.Book.Title | @Model.Book.Category</h5>
    <p class="card-text"><small class="text-muted">Publicerad @Model.Book.PublishedDate.ToString("dd MMMM yyyy"), skapad av @ViewBag.user</small></p>
    <p class="card-text">@Model.Book.Description</p>
    <p class="card-text">ISBN: @Model.Book.ISBN</p>
    <p class="card-text">Författare: 
        @foreach (var author in Model.Book.Authors)
        {
            <span>@author</span><span> </span>
        }
    </p>
    <div class="d-flex">
        <a asp-controller="Books" asp-action="Edit" asp-route-id="@Model.Book.Id" class="@(ViewBag.UserIsLoggedIn ? "d-none" : "") btn btn-warning">Redigera</a>
        <form method="post" asp-action="Delete" class="@(ViewBag.UserIsLoggedIn ? "d-none" : "") px-2">
            <input asp-for="@Model.Book.Id" type="hidden" value="@Model.Book.Id" name="id">
            <button type="submit" class="btn btn-danger">Radera</button>
        </form>
    </div>
  </div>
</div>

@* Omdöme-korten *@
@{
    if (Model.Reviews != null && Model.Reviews.Any())
    {
        @* Om det finns omdömen *@
        <h4>Omdömmen av denna bok:</h4>
            @foreach (var review in Model.Reviews)
            {
                 <div class="card border-dark mb-3">
                    <div class="card-body text-dark">
                        <div class="d-flex">
                            <h5 class="card-title">@review.CreatorName</h5>
                            <div class="d-flex mx-2">
                                @* Rita ut stjärnor baserade på betyget som användaren har angivit *@
                                @for (int i = 0; i < 5; i++)
                                {
                                    if (i < review.Points)
                                    {
                                        <i class="bi bi-star-fill"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-star"></i>
                                    }
                                }
                            </div>
                            <div class="d-flex justify-end align-items-center" style="width: 100%;">
                                <h6><small class="text-muted">@review.PublishedDate.ToString("dd MMMM yyyy HH:mm")</small></h6>
                            </div>
                        </div>
                        <p class="card-text">@review.Comment</p>
                        <form method="post" asp-controller="Reviews" asp-action="Delete" class="@(ViewBag.UserIsLoggedIn ? "d-none" : "")">
                            <input asp-for="@review.Id" name="ratingId" value="@review.Id" type="hidden">
                            <input asp-for="@Model.Book.Id" name="bookId" value="@Model.Book.Id" type="hidden">
                            <button type="submit" value="Ta bort" class="btn btn-danger"><i class="bi bi-trash"></i></button>
                        </form>
                    </div>
                </div>
            }
    }
    else {
         @* Om det inte finns några omdömen *@
        <div>
            <h6>Detta inlägg har inga omdömen än.</h6>
            <p class="@(ViewBag.UserIsLoggedIn ? "d-none" : "")">
                Bli den <strong>första</strong> att skriva något!
            </p>
            <p class="@(ViewBag.UserIsLoggedIn ? "" : "d-none")">
                <a asp-controller="Login" asp-action="Index">Logga in</a>för att lämna ett omdöme!
            </p>
        </div>
    }
    <a asp-controller="Reviews" asp-action="Create" asp-route-id="@Model.Book.Id" class="@(ViewBag.UserIsLoggedIn ? "d-none" : "")">Lämna omdöme</a>
}
